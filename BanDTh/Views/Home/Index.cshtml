@model BanDTh.Models.HomeViewModel

@{
    ViewData["Title"] = "TopStyle - Trang chủ";
    Layout = "~/Views/Shared/_Layout.cshtml";
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

}
<style>
    .carousel-control-prev,
    .carousel-control-next {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        /* làm tròn */
        background-color: #999c9e;
        /* nền đen */
        opacity: 0.3;
        /* hơi trong suốt */
        top: 50%;
        /* căn giữa */
        transform: translateY(-50%);
        margin: 0 40px;
        /* cách lề trái phải 10px */
    }

    .carousel-control-prev:hover,
    .carousel-control-next:hover {
        background-color: #e0e0e0;
        /* hover xám trắng */
        opacity: 1;
    }

    .carousel-control-prev-icon,
    .carousel-control-next-icon {
        filter: invert(1);
        /* icon thành màu trắng */
        width: 20px;
        height: 20px;


    }

    .carousel-img {
        height: 350px;
        /* chỉnh chiều cao mong muốn */
        object-fit: cover;
        /* cắt cho vừa */
    }

    .carousel-indicators [data-bs-target] {
        width: 9px;
        /* chiều ngang */
        height: 9px;
        /* chiều cao = tròn */
        border-radius: 50%;
        /* bo tròn 100% */
        background-color: #0eace6 !important;
        /* màu trắng */
        margin: 0 10px;
        /* khoảng cách giữa các cục */
    }

    .carousel-indicators .active {
        background-color: #2195fa !important;
        border-radius: 50%;
        /* màu đen cho cục đang active */
    }

    .col {
        padding-left: 5px !important;
        padding-right: 5px !important;
    }
</style>
<script>
document.addEventListener('DOMContentLoaded', () => {
  // Tìm tất cả carousel có class "carousel_"
  const carousels = document.querySelectorAll('.carousel_');

  carousels.forEach((carousel) => {
    const items = carousel.querySelectorAll('.carousel-item');
    const minPerSlide = 4; // 4 sản phẩm / slide

    items.forEach((el) => {
      let next = el.nextElementSibling;
      for (let i = 1; i < minPerSlide; i++) {
        if (!next) {
          next = items[0]; // vòng lại đầu
        }
        const cloneChild = next.firstElementChild.cloneNode(true);
        el.appendChild(cloneChild);
        next = next.nextElementSibling;
      }
    });
  });
});
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- Carousel Hình ảnh -->
<div id="carouselExampleIndicators" class="carousel slide w-full ">
    <!-- Indicators (mấy cục tròn) -->
    <div class="carousel-indicators">
        <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="0" class="active"></button>
        <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="1"></button>
        <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="2"></button>
        <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="3"></button>
        <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="4"></button>
    </div>
    <div id="hero" class="carousel-inner w-full h-100">
        <div class="carousel-item active">
            <img src="https://picsum.photos/1200/400?random=1" class="d-block w-100 carousel-img" alt="Ảnh 1">
        </div>
        <div class="carousel-item">
            <img src="https://picsum.photos/1200/400?random=2" class="d-block w-100 carousel-img" alt="Ảnh 2">
        </div>
        <div class="carousel-item">
            <img src="https://picsum.photos/1200/400?random=3" class="d-block w-100 carousel-img" alt="Ảnh 3">
        </div>
        <div class="carousel-item">
            <img src="https://picsum.photos/1200/400?random=3" class="d-block w-100 carousel-img" alt="Ảnh 3">
        </div>
        <div class="carousel-item">
            <img src="https://picsum.photos/1200/400?random=3" class="d-block w-100 carousel-img" alt="Ảnh 3">
        </div>
    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators"
        data-bs-slide="prev">
        <span class="carousel-control-prev-icon"></span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators"
        data-bs-slide="next">
        <span class="carousel-control-next-icon"></span>
    </button>
</div>
<div class="row row-cols-2 row-cols-md-6 my-5  justify-content-center ">
    @foreach (var p in Model.Categories)
    {
        <div class="col mb-4 d-flex justify-content-center ">
            @await Html.PartialAsync("_CatalogCard", p)
        </div>
    }
</div>


<

<section class="container text-light my-5">
    @foreach (var group in Model.ProductsByCategory)
    {
        // ✅ SỬA ĐỔI: Không cần tìm kiếm nữa, chỉ cần lấy trực tiếp group.Key
        var category = group.Key;

        // Chỉ hiển thị nếu category tồn tại và có sản phẩm
        @if (category != null && group.Value.Any())
        {
            var carouselId = "carousel_" + category.Slug;

            <div class="category-block mb-5">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 class="m-0">@category.Name</h4>
                    <a asp-controller="Catalog" asp-action="Index" asp-route-category="@category.Slug" class="text-info small">Xem tất cả →</a>
                </div>

                <div id="@carouselId" class="carousel slide" data-bs-interval="false">
                    <div class="carousel-inner">
                        @for (int i = 0; i < group.Value.Count; i++)
                        {
                            var p = group.Value[i];
                            <div class="carousel-item @(i == 0 ? "active" : "")">
                                <div class="d-flex justify-content-center">
                                    @await Html.PartialAsync("_ProductCard", p)
                                </div>
                            </div>
                        }
                    </div>

                    <button class="carousel-control-prev" type="button" data-bs-target="#@carouselId" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon"></span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#@carouselId" data-bs-slide="next">
                        <span class="carousel-control-next-icon"></span>
                    </button>
                </div>
            </div>
        }
    }
</section>